<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>WebAR — ArUco ثابت بجانب الماركر</title>

  <!-- مكتبات A-Frame + AR.js -->
  <link rel="preconnect" href="https://aframe.io" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script defer src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.4/aframe/build/aframe-ar.min.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root{
      color-scheme: dark;
      --glass-bg: rgba(255,255,255,.10);
      --glass-brd: rgba(255,255,255,.26);
      --txt: #fff;
    }
    html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:-apple-system,BlinkMacSystemFont,"SF Pro",Segoe UI,Roboto,Arial}
    /* إلغاء شاشة التحميل الافتراضية (الخلفية الزرقاء والنقاط) */
    .a-loader-title, .a-loader{ display:none !important; }

    /* أزرار زجاجية (يسار/منتصف عمودياً) */
    .btns{position:fixed;top:50%;left:18px;transform:translateY(-50%);display:flex;flex-direction:column;gap:12px;z-index:4}
    .gbtn{min-width:220px;display:inline-flex;align-items:center;gap:10px;padding:13px 18px;color:var(--txt);text-decoration:none;font-weight:700;font-size:15px;
      background:var(--glass-bg);border:1px solid var(--glass-brd);border-radius:20px;backdrop-filter:blur(16px) saturate(140%);-webkit-backdrop-filter:blur(16px) saturate(140%)}
    .ico{width:20px;height:20px}

    /* Toast إرشادي خفيف */
    .toast{position:fixed;right:16px;bottom:16px;z-index:5;max-width:min(320px,80vw);padding:12px 14px;border-radius:16px;
      color:#e7f5ff;background:rgba(13,110,253,.25);border:1px solid rgba(115,189,255,.4);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
    .toast button{margin-inline-start:10px;border:0;background:rgba(255,255,255,.18);color:inherit;padding:6px 10px;border-radius:12px;cursor:pointer}

    /* زر بدء صريح لضمان طلب الإذن على كل الأجهزة */
    .startOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:6}
    .startOverlay button{padding:14px 22px;font-weight:800;font-size:16px;color:#fff;background:var(--glass-bg);border:1px solid var(--glass-brd);
      border-radius:16px;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);cursor:pointer}

    @media(max-width:720px){
      .btns{top:auto;bottom:18px;left:50%;transform:translateX(-50%);flex-direction:row;flex-wrap:wrap;gap:10px}
      .gbtn{min-width:min(220px,42vw);justify-content:center}
    }
  </style>
</head>
<body>

  <!-- أزرار التسويق -->
  <nav class="btns" aria-label="روابط التواصل">
    <a class="gbtn" href="https://instagram.com/t.__x" target="_blank" rel="noopener">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="2.5" y="2.5" width="19" height="19" rx="5" stroke="currentColor" stroke-width="1.3"/><circle cx="12" cy="12" r="4.2" stroke="currentColor" stroke-width="1.3"/><circle cx="17.4" cy="6.6" r="1.2" fill="currentColor"/></svg>
      Instagram • t.__x
    </a>
    <a class="gbtn" href="mailto:tammamosama101@gmail.com">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="5" width="18" height="14" rx="3" stroke="currentColor" stroke-width="1.3"/><path d="M5.2 7.4 12 12.1l6.8-4.7" stroke="currentColor" stroke-width="1.3"/></svg>
      E-mail • tammamosama101@gmail.com
    </a>
    <a class="gbtn" href="tel:+9647822911170">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6.6 3.2h1.9l1.5 4.1-1.8 1.4a14.3 14.3 0 0 0 6.3 6.3l1.4-1.8 4.1 1.5v1.9c0 1-1 3-3 3A14.8 14.8 0 0 1 3.1 7c0-2 1.9-3.8 3.5-3.8Z" stroke="currentColor" stroke-width="1.3"/></svg>
      اتصال • 07822911170
    </a>
    <a class="gbtn" href="https://wa.me/9647822911170" target="_blank" rel="noopener">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2.4a9.6 9.6 0 0 0-8.7 13.8l-.9 3.9 4-1.3A9.6 9.6 0 1 0 12 2.4Z" stroke="currentColor" stroke-width="1.3"/><path d="M9.6 8.1c-.2.1-.5.5-.6.7-.1.4-.2.8.1 1.2.3.4.5.7.7 1l.3.4c.3.3.7.8 1.4 1.3.6.5 1.1.7 1.4.8.4.1.6.1.8-.1l.4-.5c.1-.1.2-.2.3-.3.1-.1.2-.2.4-.2.2 0 .3 0 .5.1l.6.3c.2.1.3.1.4.2.2.1.4.2.4.3.1.1.1.3 0 .4-.1.3-.3.7-.6 1-.4.5-1.1.8-1.8.7-1.1 0-2.2-.5-3.3-1.2-1-.7-1.9-1.6-2.7-2.7-.7-1.1-1.2-2.2-1.1-3.3 0-.8.2-1.5.7-1.8.3-.3.7-.5 1-.6.2 0 .3 0 .4.1.1.1.2.2.3.4.1.1.2.2.3.4.1.1.1.2 0 .3Z" fill="currentColor"/></svg>
      WhatsApp • 07822911170
    </a>
  </nav>

  <!-- تنبيه بسيط -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    اسمح للكاميرا، ثم وجّهها نحو ماركر ArUco رقم 5 — المجسّم سيظهر على يمين الماركر وبحجم أكبر.
    <button type="button">تم</button>
  </div>

  <!-- زر بدء لضمان طلب الإذن على كل الأجهزة/المتصفحات -->
  <div id="start" class="startOverlay" hidden>
    <button type="button" id="startBtn">ابدأ الواقع المعزّز</button>
  </div>

  <!-- مشهد AR — بدون شاشة تحميل، خلفية شفافة حتى ما تشوف لون أزرق -->
  <a-scene
    embedded
    loading-screen="enabled:false"
    vr-mode-ui="enabled:false"
    renderer="alpha:true; antialias:true; logarithmicDepthBuffer:true"
    arjs="sourceType: webcam; sourceWidth:640; sourceHeight:480; displayWidth:640; displayHeight:480; trackingMethod: best; detectionMode: mono; debugUIEnabled:false;">
    
    <a-assets timeout="60000">
      <!-- بدّل اسم الملف إذا لزم -->
      <a-asset-item id="glb" src="3d-1.glb"></a-asset-item>
    </a-assets>

    <!-- ماركر ArUco (barcode) رقم 5 — size بالمتر (0.16 = 16 سم) -->
    <a-marker id="markerRoot"
      type="barcode" value="5" size="0.16"
      emitevents="true"
      hide-on-lost="false"
      smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">

      <!-- الموديل: سنضبط موقعه/حجمه نسبياً لحجم الماركر -->
      <a-entity id="model"
        gltf-model="#glb"
        rotation="0 0 0"
        relative-to-marker="marker: #markerRoot; offset: 0.65 0 0; scale-multiplier: 1.35"
        animation-mixer>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // كومبوننت يربط الموديل بحجم/موضع الماركر: offset على يمين الماركر، وحجم أكبر
    AFRAME.registerComponent('relative-to-marker', {
      schema: {
        marker: { type: 'selector' },
        offset: { type: 'vec3', default: { x: 0.65, y: 0, z: 0 } }, // يمين الماركر
        'scale-multiplier': { type: 'number', default: 1.35 }       // أكبر من الماركر
      },
      tick: function () {
        const m = this.data.marker && this.data.marker.object3D;
        if (!m) return;
        const s = m.scale, o = this.data.offset, k = this.data['scale-multiplier'];
        // الحجم يتبع حجم الماركر (لمحاذاة واقعية)
        this.el.object3D.scale.set(s.x * k, s.y * k, s.z * k);
        // الموضع يمين الماركر (محور X بعد التحجيم)
        this.el.object3D.position.set(o.x * s.x, o.y * s.y, o.z * s.z);
      }
    });

    // إزالة التوست
    (document.querySelector('#toast')?.querySelector('button')||{}).onclick = () => {
      const t = document.getElementById('toast'); t.style.opacity='0'; t.style.pointerEvents='none'; setTimeout(()=>t.remove(), 300);
    };

    // ضمان طلب الإذن: إذا ما ظهر تلقائياً، أظهر زر "ابدأ" واستعمل getUserMedia بلمسة المستخدم
    function ensureCameraPrompt(){
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
      // نحاول طلب إذن سريعاً؛ إذا رفض/تعثّر، نظهر زر البدء
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { stream.getTracks().forEach(t=>t.stop()); })
        .catch(()=> document.getElementById('start').hidden = false);
    }
    document.addEventListener('DOMContentLoaded', ensureCameraPrompt);
    document.getElementById('startBtn').onclick = () => {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => { s.getTracks().forEach(t=>t.stop()); document.getElementById('start').hidden = true; })
        .catch(() => alert('⚠️ تعذّر الوصول للكاميرا. تأكد من الإذن وHTTPS.'));
    };

    // تنبيه أخطاء الكاميرا من AR.js
    window.addEventListener('camera-error', e=>{
      alert('⚠️ تعذّر الوصول للكاميرا.\nتأكد من منح الإذن واستخدم Chrome/Safari عبر HTTPS.');
      console.error(e);
    });
  </script>

  <!--
    ملاحظات:
    • اطبع ماركر ArUco بقيمة 5 (نفس value) وبحجم 16 سم أو عدّل size بالمتر.
    • عدّل offset داخل relative-to-marker للتحريك: يمين (+X)، يسار (−X)، أمام (−Z)، خلف (+Z).
    • إن كان الموديل صغير/كبير زيادة، عدّل scale-multiplier (مثلاً 1.8 أو 2).
  -->
</body>
</html>
