<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>تجربة AR مع ماركر ArUco</title>

  <!-- المكتبات الضرورية -->
  <link rel="preconnect" href="https://aframe.io" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script defer src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.4/aframe/build/aframe-ar.min.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root {
      color-scheme: dark;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, Arial, sans-serif;
    }

    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
    }

    .btns {
      position: fixed;
      top: 50%;
      left: 18px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 4;
    }

    .gbtn {
      min-width: 220px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 13px 18px;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      letter-spacing: -0.2px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.22), rgba(255, 255, 255, 0.08));
      border: 1px solid rgba(255, 255, 255, 0.26);
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(12, 19, 31, 0.35);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .gbtn:hover,
    .gbtn:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(12, 19, 31, 0.45);
    }

    .ico {
      width: 20px;
      height: 20px;
    }

    .toast {
      position: fixed;
      bottom: 16px;
      right: 16px;
      z-index: 5;
      max-width: min(320px, 80vw);
      padding: 14px 16px;
      border-radius: 18px;
      background: rgba(13, 110, 253, 0.25);
      border: 1px solid rgba(115, 189, 255, 0.4);
      color: #e7f5ff;
      font-size: 14px;
      line-height: 1.5;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      backdrop-filter: blur(18px) saturate(160%);
      -webkit-backdrop-filter: blur(18px) saturate(160%);
    }

    .toast button {
      margin-left: auto;
      margin-right: -6px;
      border: none;
      background: rgba(255, 255, 255, 0.15);
      color: inherit;
      font-weight: 600;
      border-radius: 14px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .toast button:hover,
    .toast button:focus-visible {
      background: rgba(255, 255, 255, 0.28);
    }

    @media (max-width: 720px) {
      .btns {
        top: auto;
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%);
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        padding: 0 12px;
      }

      .gbtn {
        min-width: min(220px, 42vw);
        justify-content: center;
        padding-inline: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- أزرار التسويق -->
  <nav class="btns" aria-label="روابط التواصل">
    <a class="gbtn" href="https://instagram.com/t.__x" target="_blank" rel="noopener">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="2.5" y="2.5" width="19" height="19" rx="5" stroke="currentColor" stroke-width="1.3"/><circle cx="12" cy="12" r="4.2" stroke="currentColor" stroke-width="1.3"/><circle cx="17.4" cy="6.6" r="1.2" fill="currentColor"/></svg>
      Instagram • t.__x
    </a>
    <a class="gbtn" href="mailto:tammamosama101@gmail.com">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="5" width="18" height="14" rx="3" stroke="currentColor" stroke-width="1.3"/><path d="M5.2 7.4 12 12.1l6.8-4.7" stroke="currentColor" stroke-width="1.3"/></svg>
      E-mail • tammamosama101@gmail.com
    </a>
    <a class="gbtn" href="tel:+9647822911170">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6.6 3.2h1.9l1.5 4.1-1.8 1.4a14.3 14.3 0 0 0 6.3 6.3l1.4-1.8 4.1 1.5v1.9c0 1-1 3-3 3A14.8 14.8 0 0 1 3.1 7c0-2 1.9-3.8 3.5-3.8Z" stroke="currentColor" stroke-width="1.3"/></svg>
      اتصال • 07822911170
    </a>
    <a class="gbtn" href="https://wa.me/9647822911170" target="_blank" rel="noopener">
      <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2.4a9.6 9.6 0 0 0-8.7 13.8l-.9 3.9 4-1.3A9.6 9.6 0 1 0 12 2.4Z" stroke="currentColor" stroke-width="1.3"/><path d="M9.6 8.1c-.2.1-.5.5-.6.7-.1.4-.2.8.1 1.2.3.4.5.7.7 1l.3.4c.3.3.7.8 1.4 1.3.6.5 1.1.7 1.4.8.4.1.6.1.8-.1l.4-.5c.1-.1.2-.2.3-.3.1-.1.2-.2.4-.2.2 0 .3 0 .5.1l.6.3c.2.1.3.1.4.2.2.1.4.2.4.3.1.1.1.3 0 .4-.1.3-.3.7-.6 1-.4.5-1.1.8-1.8.7-1.1 0-2.2-.5-3.3-1.2-1-.7-1.9-1.6-2.7-2.7-.7-1.1-1.2-2.2-1.1-3.3 0-.8.2-1.5.7-1.8.3-.3.7-.5 1-.6.2 0 .3 0 .4.1.1.1.2.2.3.4.1.1.2.2.3.4.1.1.1.2 0 .3Z" fill="currentColor"/></svg>
      WhatsApp • 07822911170
    </a>
  </nav>

  <div id="cameraToast" class="toast" role="status" aria-live="polite">
    <span>أعطِ صلاحية استخدام الكاميرا ثم وجّهها نحو رمز الـ QR/ArUco لرؤية المجسّم.</span>
    <button type="button" aria-label="إغلاق التنبيه">تم</button>
  </div>

  <!-- مشهد الواقع المعزّز -->
  <a-scene
    embedded
    vr-mode-ui="enabled:false"
    renderer="alpha:true; antialias:true; logarithmicDepthBuffer:true"
    arjs="sourceType: webcam; sourceWidth: 720; sourceHeight: 540; displayWidth: 720; displayHeight: 540; trackingMethod: best; detectionMode: mono; debugUIEnabled:false;">

    <a-assets timeout="60000">
      <a-asset-item id="glb" src="3d-1.glb"></a-asset-item>
    </a-assets>

    <a-marker
      id="markerRoot"
      type="barcode"
      value="5"
      emitevents="true"
      size="0.16"
      smooth="true"
      smoothCount="5"
      smoothTolerance="0.01"
      smoothThreshold="2">

      <a-entity
        id="model"
        gltf-model="#glb"
        rotation="0 0 0"
        relative-to-marker="marker: #markerRoot; offset: 0.65 0 0; scale-multiplier: 1.25"
        animation-mixer>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // يجعل موضع/مقياس المجسم مرتبطين بتغيّر حجم الماركر في المشهد
    AFRAME.registerComponent('relative-to-marker', {
      schema: {
        marker: { type: 'selector' },
        offset: { type: 'vec3', default: { x: 0.65, y: 0, z: 0 } },
        'scale-multiplier': { type: 'number', default: 1.25 }
      },
      tick: function () {
        if (!this.data.marker) return;
        const markerObj = this.data.marker.object3D;
        const markerScale = markerObj.scale;
        const offset = this.data.offset;
        const scaleMultiplier = this.data['scale-multiplier'];
        this.el.object3D.scale.set(
          markerScale.x * scaleMultiplier,
          markerScale.y * scaleMultiplier,
          markerScale.z * scaleMultiplier
        );
        this.el.object3D.position.set(
          offset.x * markerScale.x,
          offset.y * markerScale.y,
          offset.z * markerScale.z
        );
      }
    });

    const toast = document.getElementById('cameraToast');
    toast?.querySelector('button')?.addEventListener('click', () => {
      toast.style.opacity = '0';
      toast.style.pointerEvents = 'none';
      setTimeout(() => toast.remove(), 400);
    });

    window.addEventListener('camera-error', (event) => {
      alert('⚠️ تعذّر الوصول للكاميرا.\nتأكد من إعطاء الإذن واستخدام HTTPS (مثلاً GitHub Pages).');
      console.error(event);
    });

    // إن أراد المستخدم بدء طلب الإذن مباشرة فور فتح الصفحة (يساعد في تسريع الاستجابة)
    if (navigator.mediaDevices?.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true }).catch(() => {
        /* نترك AR.js يتعامل مع الأخطاء */
      });
    }
  </script>

  <!--
    🔧 تعليمات إنشاء ورفع ماركر ArUco/AprilTag:
      1. افتح مولّد ماركر ArUco مثل: https://chev.me/arucogen/ أو https://calibration.ft.unicamp.br/artoolkit/barcode-marker-generator/ .
      2. اختر قيمة رقمية (مثلاً 5 كما في الكود) واطبع/احفظ صورة الماركر بصيغة PNG أو PDF.
      3. ضع الصورة على رمز QR الخاص بك أو بجواره، واحرص أن تكون الحواف واضحة التباين.
      4. إذا غيّرت الرقم، عدّل الخاصية value في <a-marker> لنفس الرقم.
      5. أحجام الطباعة القياسية 16 سم → غيّر الخاصية size في <a-marker> إذا استخدمت مقاساً آخر (المقاس بالمتر).
  -->
</body>
</html>
